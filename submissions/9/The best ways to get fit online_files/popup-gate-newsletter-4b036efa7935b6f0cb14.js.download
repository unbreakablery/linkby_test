(window.webpackJsonp_gp_web_frontend=window.webpackJsonp_gp_web_frontend||[]).push([["popup-gate-newsletter"],{"./src/ts/components/popup-gate-newsletter/popup-gate-newsletter.ts":(e,t,s)=>{"use strict";s.r(t),s.d(t,{getSignedUp:()=>l,show:()=>d,hide:()=>m,subscribeToCRM:()=>w,subscriptionSuccess:()=>g,subscribe:()=>h,popupGateNewsletterComponent:()=>y,init:()=>_});var n=s("../react-components/dist/components/global/newsletter/popup-newsletter/popup-newsletter.css.json"),r=s("../shared-types/frontend/components/newsletter/subscription-status.ts"),i=s("../shared-types/frontend/core/store.ts"),o=s("../../node_modules/js-cookie/src/js.cookie.js"),c=s.n(o),a=s("./src/ts/utils/crm.ts"),p=s("./src/ts/utils/inview.ts");const l=()=>!!c().get(r.y.SignedUp),u=(e,t)=>{e.setAttribute("hidden","false"),t.dispatch({type:i.U.TrackEvent,payload:{pev2:"newsletter popup gate displayed",events:["event113"]}}),t.dispatch({type:i.U.DataLayerPush,payload:{action:"pop up",label:"newsletter",event:"in-view",category:"TO Impression"}})},d=(e,t)=>()=>{const s=document.querySelector("#inline-placement")||document.querySelector(".anyclip-placement");(null==s?void 0:s.childNodes.length)?(0,p.oO)({element:s,isNotInViewportCallback:()=>{u(e,t)}}):u(e,t)},m=(e,t)=>()=>{e.setAttribute("hidden","true"),t.dispatch({type:i.U.TrackEvent,payload:{pev2:"newsletter popup gate dismissed",events:["event207"]}})},w=({popupGateElement:e,store:t})=>{const s=t.subscribe(()=>{const r=t.getState();if(e.querySelector("."+n.Fq).disabled=!1,r.crm.receive)s(),g({popupGateElement:e,type:r.crm.receive.type});else if(r.crm.error){e.querySelector("."+n.N3).innerHTML=r.crm.error.message,e.classList.add(n.yt)}})},g=({popupGateElement:e,type:t})=>{if(e.classList.add(n.UJ),"popup-gate"===t){(0,a.W)(t);const s=e.dataset.popupGateNewsletterRedirectUrl;window.location.href=s}},h=(e,t)=>s=>{s.preventDefault();const r=e.querySelector(`.${n.Y2}.${n.Do}`);e.querySelector("."+n.Fq).disabled=!0,(0,a.C)(t,{copyVersion:"0001",element:"newsletter-popup-gate",email:r.value,referrer:window.location.href})},y=(e,t)=>{const s={submitListener:h(e,t),hideListener:m(e,t),init:()=>{if(l()||!window.digitalMagazinePage)return e.remove(),{};return e.querySelector("."+n.Ah).addEventListener("click",s.hideListener),e.querySelector("."+n.cZ).addEventListener("click",s.hideListener),e.querySelector("."+n.cr).addEventListener("submit",s.submitListener),w({popupGateElement:e,store:t}),{hide:s.hideListener,submit:s.submitListener}}};return s},_=(e,t)=>{const s=Math.floor(1e4*Math.random());return{listeners:y(e,t).init(),componentId:"popup-gate-newsletter-component-"+s}}},"./src/ts/config/config.ts":(e,t,s)=>{"use strict";s.d(t,{p:()=>i,u:()=>o});var n=s("./src/ts/utils/config-utils.ts");let r={};const i=()=>{const e=(0,n.P)(),t=e.site||"uk-london",[s,i]=t.split("-"),o=e.locale||"en-GB",c=e.currency_symbol||"Â£",a=e.current_commit||null,p=e.graffiti||null,l=e.discover||null,u=e.auth||null,d=e.pageUID||null;return r={...r,site:t,city:i,country:s,locale:o,currencySymbol:c,currentCommit:a,graffiti:p,discover:l,auth:u,pageUid:d},r},o=e=>{var t;return null!==(t=r[e])&&void 0!==t?t:null}},"./src/ts/core/client.ts":(e,t,s)=>{"use strict";s.d(t,{uj:()=>c,Ef:()=>p,iu:()=>l});var n=s("../shared-types/frontend/core/store.ts"),r=s("./src/ts/config/settings.ts");let i,o=!1;const c=()=>window.innerWidth>=window.innerHeight?"landscape":"portrait",a=e=>{const{client:{breakpoint:t}}=e.getState(),s=(({width:e,currentBreakpoint:t,breakpoints:s=r.aj})=>(Object.entries(s).some(([s,{min_width:n,max_width:r}])=>{const i={min:!1,max:!1};return(e>=n||0===n)&&(i.min=!0),(e<=r||0===r)&&(i.max=!0),!(!i.min||!i.max||s===t)&&(t=s,!0)}),t))({width:window.innerWidth,currentBreakpoint:t});t!==s&&e.dispatch({type:n.U.ClientBreakpoint,payload:{breakpoint:s}})},p=()=>{if(o)return;const e=window.gpStore;i=e,(e=>{const t=()=>{a(e)};window.matchMedia(`(min-width: ${r.aj.sm.min_width}px)`).addListener(t),window.matchMedia(`(min-width: ${r.aj.md.min_width}px)`).addListener(t),window.matchMedia(`(min-width: ${r.aj.lg.min_width}px)`).addListener(t)})(e),(e=>{a(e)})(e),o=!0},l=()=>i.getState().client.breakpoint},"./src/ts/utils/config-utils.ts":(e,t,s)=>{"use strict";s.d(t,{P:()=>n,R:()=>r});const n=()=>{const e={};return document.querySelectorAll("meta").forEach(t=>{const s=t.name?t.name:t.getAttribute("property")||!1;s&&(e[s]=t.content?t.content:t.dataset)}),e},r=(e=document)=>e.querySelector("body").dataset.pageType},"./src/ts/utils/crm.ts":(e,t,s)=>{"use strict";s.d(t,{C:()=>u,W:()=>h});var n=s("../shared-types/frontend/components/newsletter/subscription-status.ts"),r=s("../shared-types/frontend/core/store.ts"),i=s("../../node_modules/js-cookie/src/js.cookie.js"),o=s.n(i),c=s("./src/ts/config/config.ts"),a=s("./src/ts/core/client.ts"),p=s("./src/ts/core/omniture/omniture-utils.ts"),l=s("./src/ts/utils/request.ts");const u=async(e,t)=>m(e,w(e,t)),d={"newsletter-footer":"footer","newsletter-popup":"popup","newsletter-nav":"nav","newsletter-popup-gate":"popup-gate","newsletter-inline":"inline","newsletter-lander":"lander"},m=async(e,t)=>{try{const s=await(0,l.j0)({url:(0,c.u)("auth"),headers:{"Content-Type":"application/json"},data:t});return o().set(n.y.SignedUp,""+Date.now(),{expires:365}),e.dispatch({type:r.U.CRMReceive,payload:{...s,type:d[t.element]}}),s}catch(t){e.dispatch({type:r.U.CRMError,payload:{message:t.message,timestamp:Date.now()}})}},w=(e,{email:t,referrer:s,element:n,copyVersion:i="0001"})=>{const o=`s=GP&p=${n}&d=${(0,a.iu)()}&u=${(0,p.WX)()}&c=${i}`,l={email:t,site:(0,c.u)("site"),locale:(0,c.u)("locale"),platform:o,element:n,referrer:s};return e.dispatch({type:r.U.CRMSend,payload:l}),l},g={footer:"Newsletter Footer Success","list-feature":"Newsletter Inline Success",nav:"Newsletter Header Success",popup:"Newsletter Popup Success","popup-gate":"Newsletter Gate Success",inline:"Newsletter Inline Success",lander:"Newsletter Lander Success"},h=(e="")=>{var t,s;if(!(null===(s=null===(t=window.PARSELY)||void 0===t?void 0:t.conversions)||void 0===s?void 0:s.trackNewsletterSignup))return!1;const n=g[e];return!!n&&(window.PARSELY.conversions.trackNewsletterSignup(n),!0)}},"./src/ts/utils/inview.ts":(e,t,s)=>{"use strict";s.d(t,{oe:()=>n,oO:()=>r,W0:()=>i});const n=e=>{if(!e)return!1;const t=e.getBoundingClientRect(),s=window.innerHeight||document.documentElement.clientHeight,n=window.innerWidth||document.documentElement.clientWidth,r=t.top<=s&&t.top+t.height>=0,i=t.left<=n&&t.left+t.width>=0;return r&&i};function r({element:e,observerOptions:t={},isInViewportCallback:s,isNotInViewportCallback:n}){new IntersectionObserver((e,t)=>{e.forEach(e=>{e.isIntersecting&&s&&(n||t.unobserve(e.target),s(e)),!e.isIntersecting&&n&&(s||t.unobserve(e.target),n(e))})},t).observe(e)}function i(e,t){return e?new Promise(s=>{r({element:e,observerOptions:t,isInViewportCallback:s})}):Promise.reject()}},"../shared-types/frontend/components/newsletter/subscription-status.ts":(e,t,s)=>{"use strict";var n;s.d(t,{y:()=>n}),function(e){e.SignedUp="_TO_Newsletter_SignedUp",e.Dismissed="_TO_Newsletter_Dismissed",e.PageViewCount="_TO_Newsletter_PageViewCount"}(n||(n={}))},"../react-components/dist/components/global/newsletter/popup-newsletter/popup-newsletter.css.json":e=>{"use strict";e.exports=JSON.parse('{"UJ":"_hasSuccess_149je_26","Ah":"_closeButton_149je_51","cr":"_form_149je_82","Y2":"_textInput_149je_108","N3":"_errorMessage_149je_121","yt":"_hasEmailError_149je_133","Do":"_email_149je_133","Fq":"_submitButton_149je_146","cZ":"_dismissButton_149je_177"}')}}]);